<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Puffly x Arixo - Creator Edition</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --puffly-green: #00c896;
            --puffly-grad: linear-gradient(135deg, #00c896, #00e0b0);
            --bubble-you: #e6ffad; 
            --glass: rgba(0, 0, 0, 0.6);
            --gold: #ffcc00;
        }
        body { margin:0; font-family:'Inter', sans-serif; background:#000; color:#fff; overflow:hidden; }
        .page { display:none; height:100vh; width:100%; position:absolute; top:0; left:0; }
        .page.active { display:block; }
        .nav { position:fixed; bottom:0; width:100%; display:flex; justify-content:space-around; align-items:center; background:rgba(0,0,0,0.9); padding:10px 0 25px; z-index:9999; border-top:1px solid #222; }
        .nav button { background:none; border:none; color:#777; display:flex; flex-direction:column; align-items:center; font-size:11px; flex:1; cursor:pointer; outline:none; }
        .nav button.active { color:var(--puffly-green); }

        .nav .upload-btn {
            background: var(--puffly-grad);
            width: 65px; height: 40px; border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
            color: #000; font-size: 20px; margin-top: -10px;
            box-shadow: 0 4px 12px rgba(0,200,150,0.4);
            cursor: pointer; border: 1.5px solid rgba(255,255,255,0.3);
        }

        .video-card { width:100%; height:100vh; scroll-snap-align:start; position:relative; }
        video { width:100%; height:100%; object-fit:cover; }
        .feed-sidebar { position:absolute; right:12px; bottom:100px; display:flex; flex-direction:column; gap:10px; align-items:center; z-index:100; }
        .btn-circle { width:42px; height:42px; border-radius:50%; background:var(--glass); display:flex; align-items:center; justify-content:center; font-size:20px; border:1px solid rgba(255,255,255,0.2); cursor:pointer; backdrop-filter:blur(5px); }
        .btn-circle.liked { color:var(--puffly-green); border-color:var(--puffly-green); }
        .action-label { font-size:10px; margin-top:2px; text-shadow: 0 1px 2px #000; }
        .music-disc { width:40px; height:40px; border-radius:50%; background:radial-gradient(circle, #333 20%, #000 100%); border:3px solid #222; display:flex; align-items:center; justify-content:center; animation:rotate 3s linear infinite; }
        @keyframes rotate { from { transform:rotate(0deg); } to { transform:rotate(360deg); } }
    </style>
</head>
<body>

<div id="giftAlert" style="position: fixed; top: 15%; left: 50%; transform: translateX(-50%); background: var(--puffly-green); color: #000; padding: 12px 25px; border-radius: 30px; font-weight: bold; z-index: 10005; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: center; min-width: 200px;">
    <i class="fa-solid fa-gift"></i> <span id="giftAlertText"></span>
</div>

<div id="page-feed" class="page active">
    <div id="feedContainer" style="height:100vh; overflow-y:scroll; scroll-snap-type:y mandatory;"></div>
</div>

<div id="page-chat" class="page">
    <div class="chat-container" style="height:100vh; display:flex; flex-direction:column;">
        <div class="chat-header" style="padding:45px 20px 15px; background:#111; border-bottom:1px solid #222; display:flex; justify-content:space-between; align-items:center;">
            <div>
                <b style="font-size:18px;"><i class="fa-solid fa-comment-dots"></i> ‡πÅ‡∏ä‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</b><br>
                <small id="chatStatusText" style="color:var(--puffly-green);">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Arixo</small>
            </div>
            <div style="display:flex; gap:18px; font-size:18px;">
                <i class="fa-solid fa-phone" onclick="startCall('‡πÄ‡∏™‡∏µ‡∏¢‡∏á')"></i>
                <i class="fa-solid fa-video" onclick="startCall('‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠')"></i>
                <i class="fa-solid fa-ban" id="blockBtn" style="color:#ff4444;" onclick="toggleBlock()"></i>
            </div>
        </div>
        <div id="chatBox" style="flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:12px; padding-bottom:150px;"></div>
        
        <div id="extraMenu" style="display:none; background:#1a1a1a; padding:15px; border-radius:20px 20px 0 0; position:fixed; bottom:145px; width:100%; box-sizing:border-box; grid-template-columns: repeat(4, 1fr); gap:10px; border-top:1px solid #333;">
            <div class="extra-item" onclick="sendMedia('‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û')" style="text-align:center; font-size:10px; color:#888;"><i class="fa-solid fa-image" style="font-size:20px; color:#fff; display:block; margin-bottom:5px;"></i>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>
            <div class="extra-item" onclick="sendMedia('‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥')" style="text-align:center; font-size:10px; color:#888;"><i class="fa-solid fa-face-smile" style="font-size:20px; color:#fff; display:block; margin-bottom:5px;"></i>‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥</div>
            <div class="extra-item" onclick="sendMedia('‡πÑ‡∏ü‡∏•‡πå')" style="text-align:center; font-size:10px; color:#888;"><i class="fa-solid fa-file-arrow-up" style="font-size:20px; color:#fff; display:block; margin-bottom:5px;"></i>‡πÑ‡∏ü‡∏•‡πå</div>
            <div class="extra-item" onclick="sendMedia('‡πÄ‡∏™‡∏µ‡∏¢‡∏á')" style="text-align:center; font-size:10px; color:#888;"><i class="fa-solid fa-microphone" style="font-size:20px; color:#fff; display:block; margin-bottom:5px;"></i>‡πÄ‡∏™‡∏µ‡∏¢‡∏á</div>
        </div>

        <div class="chat-input-bar" style="position:fixed; bottom:85px; width:100%; padding:15px; background:#111; display:flex; gap:10px; box-sizing:border-box; border-top:1px solid #222;">
            <button onclick="toggleExtraMenu()" style="background:#333; color:#fff; border:none; border-radius:50%; width:42px; height:42px;"><i class="fa-solid fa-plus"></i></button>
            <input type="text" id="chatInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß..." style="flex:1; padding:12px 15px; border-radius:25px; border:none; background:#222; color:#fff; outline:none;">
            <button onclick="sendPrivateMsg()" style="background:var(--puffly-green); border:none; border-radius:50%; width:42px; height:42px; color:#000;"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>
</div>
<div id="page-profile" class="page" style="background:#000; padding:60px 0 100px; overflow-y: auto;">
    <div style="text-align:center; padding: 0 20px;">
        <div style="position: relative; width:100px; height:100px; margin:0 auto;">
            <div id="profilePicDisplay" style="width:100px; height:100px; background:var(--puffly-grad); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:40px; color:#000; overflow:hidden;">
                <span>üéÆ</span>
            </div>
            <label for="imgUpload" style="position:absolute; bottom:0; right:0; background:#fff; width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; border:2px solid #000;">
                <i class="fa-solid fa-camera" style="color:#000; font-size:14px;"></i>
            </label>
            <input type="file" id="imgUpload" hidden accept="image/*" onchange="updateProfilePic(event)">
        </div>
        <div style="margin-top:15px; display:flex; align-items:center; justify-content:center; gap:10px;">
            <h2 id="profileName" style="margin:0;">@Creator_Asura</h2>
            <i class="fa-solid fa-pen-to-square" style="color:#888; cursor:pointer;" onclick="editProfileName()"></i>
        </div>
        <p id="profileBio" style="color:#888; margin:5px 0;">‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏° Asura's Ransom</p>
        <div id="followerCountDisplay" style="font-size:12px; color:var(--puffly-green);">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°: 0 ‡∏Ñ‡∏ô</div>
        
        <button id="loginBtn" onclick="loginWithGoogle()" style="margin-top:10px; background:#fff; color:#000; border:none; padding:8px 15px; border-radius:15px; font-weight:bold; font-size:12px; cursor:pointer;">
            <i class="fa-brands fa-google"></i> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google
        </button>
    </div>

    <div style="display: flex; gap: 10px; padding: 0 20px; margin-top: 20px;">
        <div onclick="document.getElementById('rechargeMenu').style.display='block'" style="flex: 1; background: #222; padding: 15px; border-radius: 20px; border: 1px solid var(--gold); text-align: center; cursor:pointer;">
            <small style="color:var(--gold); font-size: 10px;">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¢‡πå</small>
            <div style="font-size: 16px; font-weight: bold; color: #fff;">‡∏ø<span id="userBalanceDisplay">0.00</span></div>
        </div>
        <div style="flex: 1; background: #222; padding: 15px; border-radius: 20px; border: 1px solid var(--puffly-green); text-align: center;">
            <small style="color:var(--puffly-green); font-size: 10px;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏™‡∏°</small>
            <div style="font-size: 16px; font-weight: bold; color: #fff;">‡∏ø<span id="walletBalance">0.00</span></div>
        </div>
    </div>
    <div style="text-align:center; margin-top:10px;">
        <button id="withdrawBtn" onclick="withdrawMoney()" style="background:#333; color:#888; border:none; padding:8px 25px; border-radius:20px; font-weight:bold; font-size:12px; cursor:not-allowed;">‡∏ñ‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 1,000 ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°)</button>
    </div>

    <div style="display:flex; justify-content:space-around; border-top:1px solid #222; margin-top:20px;">
        <button onclick="switchTab('my-vids', this)" class="tab-btn active-tab" style="background:none; border:none; color:var(--puffly-green); padding:15px; flex:1;"><i class="fa-solid fa-table-cells"></i></button>
        <button onclick="switchTab('liked-vids', this)" class="tab-btn" style="background:none; border:none; color:#555; padding:15px; flex:1;"><i class="fa-solid fa-heart"></i></button>
    </div>
    <div id="tabContent" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; padding: 2px;"></div>
</div>

<div id="rechargeMenu" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; background: #1a1a1a; border: 2px solid var(--gold); border-radius: 25px; padding: 20px; z-index: 10005; box-shadow: 0 0 40px rgba(0,0,0,0.9); box-sizing: border-box;">
    <div style="text-align:center; margin-bottom:20px;">
        <h3 style="color:var(--gold); margin:0; font-size: 20px;">üíé ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç Puffly</h3>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <div onclick="addMoney(100)" style="background:#252525; padding:15px; border-radius:15px; text-align:center; cursor:pointer;">
            <div style="color:var(--gold); font-weight:bold;">100 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</div>
            <div style="font-size:11px; color:#aaa;">‡∏ø35.00</div>
        </div>
        <div onclick="addMoney(1000)" style="background:#252525; padding:15px; border-radius:15px; text-align:center; cursor:pointer;">
            <div style="color:var(--gold); font-weight:bold;">1,000 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</div>
            <div style="font-size:11px; color:#aaa;">‡∏ø299.00</div>
        </div>
    </div>
    <button onclick="document.getElementById('rechargeMenu').style.display='none'" style="width:100%; margin-top:20px; background:none; border:none; color:#777;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</div>

<div class="nav">
    <button onclick="changePage('page-feed', this)" class="active"><i class="fa-solid fa-house"></i><span>‡∏™‡∏≥‡∏£‡∏ß‡∏à</span></button>
    <button onclick="changePage('page-chat', this)"><i class="fa-solid fa-comment-dots"></i><span>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span></button>
    <div class="upload-btn" onclick="checkAuthAndAction('upload')"><i class="fa-solid fa-plus"></i></div>
    <button onclick="checkAuthAndAction('live')"><i class="fa-solid fa-tower-broadcast"></i><span>‡πÑ‡∏•‡∏ü‡πå</span></button>
    <button onclick="changePage('page-profile', this)"><i class="fa-solid fa-user-ninja"></i><span>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span></button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
    // --- 1. Firebase Config (‡πÉ‡∏™‡πà API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà) ---
    const firebaseConfig = { apiKey: "YOUR_KEY", authDomain: "YOUR_DOMAIN", projectId: "YOUR_ID" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let currentUserData = { balance: 0, earnings: 0, followers: 0 };

    // --- 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (1,000 Followers) ---
    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginBtn').style.display = 'none';
            db.collection("users").doc(user.uid).onSnapshot(doc => {
                if (doc.exists) {
                    currentUserData = doc.data();
                    updateUI();
                } else {
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô DB
                    db.collection("users").doc(user.uid).set({ balance: 0, earnings: 0, followers: 0, name: user.displayName });
                }
            });
        }
    });

    function updateUI() {
        document.getElementById('userBalanceDisplay').innerText = currentUserData.balance.toLocaleString();
        document.getElementById('walletBalance').innerText = currentUserData.earnings.toLocaleString();
        document.getElementById('followerCountDisplay').innerText = `‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°: ${currentUserData.followers} ‡∏Ñ‡∏ô`;
        
        const withdrawBtn = document.getElementById('withdrawBtn');
        if (currentUserData.followers >= 1000) {
            withdrawBtn.style.background = "var(--puffly-green)";
            withdrawBtn.style.color = "#000";
            withdrawBtn.style.cursor = "pointer";
            withdrawBtn.innerText = "‡∏ñ‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏™‡∏° (‡∏´‡∏±‡∏Å 5%)";
        }
    }

    function checkAuthAndAction(action) {
        if (!auth.currentUser) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô");
        if (currentUserData.followers < 1000) {
            return alert("üîí ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Creator ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° 1,000 ‡∏Ñ‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ");
        }
        alert("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö " + action);
    }

    // --- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á (‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô) ---
    function changePage(pageId, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
    }

    async function loginWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        await auth.signInWithPopup(provider);
    }

    window.onload = () => { /* init feed logic here */ };
</script>
</body>
</html>
