<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Puffly x Arixo Masterpiece - Creator Edition</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --puffly-green: #00c896;
            --puffly-grad: linear-gradient(135deg, #00c896, #00e0b0);
            --bubble-you: #e6ffad; 
            --glass: rgba(0, 0, 0, 0.6);
            --gold: #ffcc00;
        }
        body { margin:0; font-family:'Inter', sans-serif; background:#000; color:#fff; overflow:hidden; }
        .page { display:none; height:100vh; width:100%; position:absolute; top:0; left:0; }
        .page.active { display:block; }
        .nav { position:fixed; bottom:0; width:100%; display:flex; justify-content:space-around; align-items:center; background:rgba(0,0,0,0.9); padding:10px 0 25px; z-index:9999; border-top:1px solid #222; }
        .nav button { background:none; border:none; color:#777; display:flex; flex-direction:column; align-items:center; font-size:11px; flex:1; cursor:pointer; outline:none; }
        .nav button.active { color:var(--puffly-green); }

        .nav .upload-btn {
            background: var(--puffly-grad);
            width: 65px; height: 40px; border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
            color: #000; font-size: 20px; margin-top: -10px;
            box-shadow: 0 4px 12px rgba(0,200,150,0.4);
            cursor: pointer; border: 1.5px solid rgba(255,255,255,0.3);
        }

        .video-card { width:100%; height:100vh; scroll-snap-align:start; position:relative; }
        video { width:100%; height:100%; object-fit:cover; }
        .feed-sidebar { position:absolute; right:12px; bottom:100px; display:flex; flex-direction:column; gap:10px; align-items:center; z-index:100; }
        .btn-circle { width:42px; height:42px; border-radius:50%; background:var(--glass); display:flex; align-items:center; justify-content:center; font-size:20px; border:1px solid rgba(255,255,255,0.2); cursor:pointer; backdrop-filter:blur(5px); }
        .btn-circle.liked { color:var(--puffly-green); border-color:var(--puffly-green); }
        .action-label { font-size:10px; margin-top:2px; text-shadow: 0 1px 2px #000; }
        .music-disc { width:40px; height:40px; border-radius:50%; background:radial-gradient(circle, #333 20%, #000 100%); border:3px solid #222; display:flex; align-items:center; justify-content:center; animation:rotate 3s linear infinite; }
        @keyframes rotate { from { transform:rotate(0deg); } to { transform:rotate(360deg); } }
    </style>
</head>
<body>

<div id="giftAlert" style="position: fixed; top: 15%; left: 50%; transform: translateX(-50%); background: var(--puffly-green); color: #000; padding: 12px 25px; border-radius: 30px; font-weight: bold; z-index: 10005; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: center; min-width: 200px;">
    <i class="fa-solid fa-gift"></i> <span id="giftAlertText"></span>
</div>

<div id="page-feed" class="page active">
    <div id="feedContainer" style="height:100vh; overflow-y:scroll; scroll-snap-type:y mandatory;"></div>
</div>

<div id="page-chat" class="page">
    <div class="chat-container" style="height:100vh; display:flex; flex-direction:column;">
        <div class="chat-header" style="padding:45px 20px 15px; background:#111; border-bottom:1px solid #222; display:flex; justify-content:space-between; align-items:center;">
            <div>
                <b style="font-size:18px;"><i class="fa-solid fa-comment-dots"></i> ‡πÅ‡∏ä‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</b><br>
                <small id="chatStatusText" style="color:var(--puffly-green);">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Arixo</small>
            </div>
            <div style="display:flex; gap:18px; font-size:18px;">
                <i class="fa-solid fa-phone" onclick="startCall('‡πÄ‡∏™‡∏µ‡∏¢‡∏á')"></i>
                <i class="fa-solid fa-video" onclick="startCall('‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠')"></i>
                <i class="fa-solid fa-ban" id="blockBtn" style="color:#ff4444;" onclick="toggleBlock()"></i>
            </div>
        </div>
        <div id="chatBox" style="flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:12px; padding-bottom:150px;"></div>
        
        <div id="extraMenu" style="display:none; background:#1a1a1a; padding:15px; border-radius:20px 20px 0 0; position:fixed; bottom:145px; width:100%; box-sizing:border-box; grid-template-columns: repeat(4, 1fr); gap:10px; border-top:1px solid #333;">
            <div class="extra-item" onclick="sendMedia('‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û')" style="text-align:center; font-size:10px; color:#888;"><i class="fa-solid fa-image" style="font-size:20px; color:#fff; display:block; margin-bottom:5px;"></i>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>
            <div class="extra-item" onclick="sendMedia('‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥')" style="text-align:center; font-size:10px; color:#888;"><i class="fa-solid fa-face-smile" style="font-size:20px; color:#fff; display:block; margin-bottom:5px;"></i>‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥</div>
            <div class="extra-item" onclick="sendMedia('‡πÑ‡∏ü‡∏•‡πå')" style="text-align:center; font-size:10px; color:#888;"><i class="fa-solid fa-file-arrow-up" style="font-size:20px; color:#fff; display:block; margin-bottom:5px;"></i>‡πÑ‡∏ü‡∏•‡πå</div>
            <div class="extra-item" onclick="sendMedia('‡πÄ‡∏™‡∏µ‡∏¢‡∏á')" style="text-align:center; font-size:10px; color:#888;"><i class="fa-solid fa-microphone" style="font-size:20px; color:#fff; display:block; margin-bottom:5px;"></i>‡πÄ‡∏™‡∏µ‡∏¢‡∏á</div>
        </div>

        <div class="chat-input-bar" style="position:fixed; bottom:85px; width:100%; padding:15px; background:#111; display:flex; gap:10px; box-sizing:border-box; border-top:1px solid #222;">
            <button onclick="toggleExtraMenu()" style="background:#333; color:#fff; border:none; border-radius:50%; width:42px; height:42px;"><i class="fa-solid fa-plus"></i></button>
            <input type="text" id="chatInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß..." style="flex:1; padding:12px 15px; border-radius:25px; border:none; background:#222; color:#fff; outline:none;">
            <button onclick="sendPrivateMsg()" style="background:var(--puffly-green); border:none; border-radius:50%; width:42px; height:42px; color:#000;"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>
</div>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
    // --- 1. Firebase Config (‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) ---
    const firebaseConfig = {
      apiKey: "AIzaSyACTSU6LYObSv5gEAfKJt4Yr4LaCCAkQvw",
      authDomain: "goldorax-game.firebaseapp.com",
      databaseURL: "https://goldorax-game-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "goldorax-game",
      storageBucket: "goldorax-game.firebasestorage.app",
      messagingSenderId: "601999451419",
      appId: "1:601999451419:web:f0782a8437b493eb8f5fbe",
      measurementId: "G-09PW99QK06"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let userData = { balance: 0, earnings: 0, followers: 0 };
    let playerDocId = ""; // ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≤‡∏Å email ‡∏ï‡∏≤‡∏° Rules ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

    // --- 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° Security Rules (hoo_hey_how_players) ---
    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginBtn').style.display = 'none';
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î DocId ‡∏ï‡∏≤‡∏°‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô Rules: ‡∏ï‡∏±‡∏î‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤ @ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ email ‡πÄ‡∏ï‡πá‡∏°
            playerDocId = user.email === 'admin@gmail.com' ? 'admin@gmail.com' : user.email.split('@')[0];

            db.collection("hoo_hey_how_players").doc(playerDocId).onSnapshot(doc => {
                if (doc.exists) {
                    userData = doc.data();
                    updateUI();
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç Rules (balance ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 0)
                    db.collection("hoo_hey_how_players").doc(playerDocId).set({
                        uid: user.uid,
                        name: user.displayName,
                        balance: 0,
                        earnings: 0,
                        followers: 0,
                        role: 'user'
                    }).catch(err => console.log("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏° Rules:", err));
                }
            });
        }
    });

    function updateUI() {
        document.getElementById('userBalanceDisplay').innerText = (userData.balance || 0).toLocaleString();
        document.getElementById('walletBalance').innerText = (userData.earnings || 0).toLocaleString();
        document.getElementById('followerCountDisplay').innerText = `‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°: ${userData.followers || 0} ‡∏Ñ‡∏ô`;
        
        // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 1,000 ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
        const withdrawBtn = document.getElementById('withdrawBtn');
        if ((userData.followers || 0) >= 1000) {
            withdrawBtn.style.background = "var(--puffly-green)";
            withdrawBtn.style.color = "#000";
            withdrawBtn.style.cursor = "pointer";
            withdrawBtn.innerText = "‡∏ñ‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏™‡∏° (‡∏´‡∏±‡∏Å 5%)";
        }
    }

    // --- 3. ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Database) ---
    function checkCreatorPrivilege(action) {
        if (!auth.currentUser) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
        if ((userData.followers || 0) < 1000) {
            return alert(`üîí ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå ${action} ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° 1,000 ‡∏Ñ‡∏ô (‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ ${userData.followers})`);
        }
        alert("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö " + action);
    }

    // --- 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç (‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô Database) ---
    async function processGift(name, price) {
        if (!auth.currentUser) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô");
        if (userData.balance < price) return alert("‡∏¢‡∏≠‡∏î‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠!");

        if (confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á ${name} ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ø${price}?`)) {
            try {
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Firestore ‡∏ï‡∏≤‡∏° DocId ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
                await db.collection("hoo_hey_how_players").doc(playerDocId).update({
                    balance: firebase.firestore.FieldValue.increment(-price),
                    earnings: firebase.firestore.FieldValue.increment(price * 0.7) // ‡∏Ñ‡∏£‡∏µ‡πÄ‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ 70%
                });
                showGiftAlert(`‡∏™‡πà‡∏á ${name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
            } catch (err) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
            }
        }
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å) ---
    function showGiftAlert(txt) {
        const alertBox = document.getElementById('giftAlert');
        document.getElementById('giftAlertText').innerText = txt;
        alertBox.style.display = 'block';
        setTimeout(() => { alertBox.style.display = 'none'; }, 3000);
    }

    async function loginWithGoogle() {
        try {
            const provider = new firebase.auth.GoogleAuthProvider();
            await auth.signInWithPopup(provider);
        } catch (err) { alert("Login Error: " + err.message); }
    }

    // --- ‡∏ô‡∏≥‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô initFeed ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ---
    window.onload = () => { /* initFeed(); */ };
</script>
</body>
</html>
