<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Puffly x Arixo Masterpiece - Creator Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --puffly-green: #00c896;
            --puffly-grad: linear-gradient(135deg, #00c896, #00e0b0);
            --bubble-you: #e6ffad; 
            --glass: rgba(0, 0, 0, 0.6);
            --gold: #ffcc00;
        }
        body { margin:0; font-family:'Inter', sans-serif; background:#000; color:#fff; overflow:hidden; }
        .page { display:none; height:100vh; width:100%; position:absolute; top:0; left:0; }
        .page.active { display:block; }
        .nav { position:fixed; bottom:0; width:100%; display:flex; justify-content:space-around; align-items:center; background:rgba(0,0,0,0.9); padding:10px 0 25px; z-index:9999; border-top:1px solid #222; }
        .nav button { background:none; border:none; color:#777; display:flex; flex-direction:column; align-items:center; font-size:11px; flex:1; cursor:pointer; outline:none; }
        .nav button.active { color:var(--puffly-green); }

        .nav .upload-btn {
            background: var(--puffly-grad);
            width: 65px; height: 40px; border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
            color: #000; font-size: 20px; margin-top: -10px;
            box-shadow: 0 4px 12px rgba(0,200,150,0.4);
            cursor: pointer; border: 1.5px solid rgba(255,255,255,0.3);
        }

        .video-card { width:100%; height:100vh; scroll-snap-align:start; position:relative; }
        video { width:100%; height:100%; object-fit:cover; }
        .feed-sidebar { position:absolute; right:12px; bottom:100px; display:flex; flex-direction:column; gap:10px; align-items:center; z-index:100; }
        .btn-circle { width:42px; height:42px; border-radius:50%; background:var(--glass); display:flex; align-items:center; justify-content:center; font-size:20px; border:1px solid rgba(255,255,255,0.2); cursor:pointer; backdrop-filter:blur(5px); }
        .btn-circle.liked { color:var(--puffly-green); border-color:var(--puffly-green); }
        .action-label { font-size:10px; margin-top:2px; text-shadow: 0 1px 2px #000; }
        .music-disc { width:40px; height:40px; border-radius:50%; background:radial-gradient(circle, #333 20%, #000 100%); border:3px solid #222; display:flex; align-items:center; justify-content:center; animation:rotate 3s linear infinite; }
        @keyframes rotate { from { transform:rotate(0deg); } to { transform:rotate(360deg); } }
    </style>
</head>
<body>
    <div id="page-profile" class="page" style="background:#000; padding:60px 0 100px; overflow-y: auto;">
    <div style="text-align:center; padding: 0 20px;">
        <div style="position: relative; width:100px; height:100px; margin:0 auto;">
            <div id="profilePicDisplay" style="width:100px; height:100px; background:var(--puffly-grad); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:40px; color:#000; overflow:hidden;">
                <span>üéÆ</span>
            </div>
            <label for="imgUpload" style="position:absolute; bottom:0; right:0; background:#fff; width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; border:2px solid #000;">
                <i class="fa-solid fa-camera" style="color:#000; font-size:14px;"></i>
            </label>
            <input type="file" id="imgUpload" hidden accept="image/*" onchange="updateProfilePic(event)">
        </div>
        <div style="margin-top:15px; display:flex; align-items:center; justify-content:center; gap:10px;">
            <h2 id="profileName" style="margin:0;">@Creator_Asura</h2>
            <i class="fa-solid fa-pen-to-square" style="color:#888; cursor:pointer;" onclick="editProfileName()"></i>
        </div>
        <p style="color:#888; margin:5px 0;">‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏° Asura's Ransom</p>
        <div id="followerCountDisplay" style="font-size:13px; color:var(--puffly-green); margin-bottom:10px;">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°: 0 ‡∏Ñ‡∏ô</div>
        <button id="loginBtn" onclick="loginWithGoogle()" style="background:#fff; color:#000; border:none; padding:8px 15px; border-radius:15px; font-weight:bold; font-size:12px; cursor:pointer;">
            <i class="fa-brands fa-google"></i> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google
        </button>
    </div>

    <div style="display: flex; gap: 10px; padding: 0 20px; margin-top: 20px;">
        <div onclick="document.getElementById('rechargeMenu').style.display='block'" style="flex: 1; background: #222; padding: 15px; border-radius: 20px; border: 1px solid var(--gold); text-align: center; cursor:pointer;">
            <small style="color:var(--gold); font-size: 10px;">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¢‡πå</small>
            <div style="font-size: 16px; font-weight: bold; color: #fff;">‡∏ø<span id="userBalanceDisplay">0.00</span></div>
        </div>
        <div style="flex: 1; background: #222; padding: 15px; border-radius: 20px; border: 1px solid var(--puffly-green); text-align: center;">
            <small style="color:var(--puffly-green); font-size: 10px;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏™‡∏°</small>
            <div style="font-size: 16px; font-weight: bold; color: #fff;">‡∏ø<span id="walletBalance">0.00</span></div>
        </div>
    </div>
    <div style="text-align:center; margin-top:10px;">
        <button id="withdrawBtn" onclick="withdrawMoney()" style="background:#333; color:#888; border:none; padding:8px 25px; border-radius:20px; font-weight:bold; font-size:12px; cursor:not-allowed;">‡∏ñ‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 1,000 ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°)</button>
    </div>

    <div style="display:flex; justify-content:space-around; border-top:1px solid #222; margin-top:20px;">
        <button onclick="switchTab('my-vids', this)" class="tab-btn active-tab" style="background:none; border:none; color:var(--puffly-green); padding:15px; flex:1;"><i class="fa-solid fa-table-cells"></i></button>
        <button onclick="switchTab('liked-vids', this)" class="tab-btn" style="background:none; border:none; color:#555; padding:15px; flex:1;"><i class="fa-solid fa-heart"></i></button>
        <button onclick="switchTab('saved-vids', this)" class="tab-btn" style="background:none; border:none; color:#555; padding:15px; flex:1;"><i class="fa-solid fa-bookmark"></i></button>
    </div>
    <div id="tabContent" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; padding: 2px;"></div>
</div>

<div id="giftMenu" style="display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(20, 20, 20, 0.98); border-top: 2px solid var(--puffly-green); border-radius: 25px 25px 0 0; padding: 20px; z-index: 10002; box-sizing: border-box;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <b style="color:var(--puffly-green); font-size:16px;">üéÅ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô</b>
        <i class="fa-solid fa-circle-xmark" style="cursor:pointer; font-size:20px; color:#555;" onclick="toggleGiftMenu(false)"></i>
    </div>
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
        <div onclick="processGift('‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏° üç¶', 50)" style="background:rgba(255,255,255,0.05); padding:10px; border-radius:15px; text-align:center;">üç¶<br><small>‡∏ø50</small></div>
        <div onclick="processGift('‡∏à‡∏≠‡∏¢‡∏ó‡∏≠‡∏á üéÆ', 500)" style="background:rgba(255,255,255,0.05); padding:10px; border-radius:15px; text-align:center;">üéÆ<br><small>‡∏ø500</small></div>
        <div onclick="processGift('‡πÄ‡∏û‡∏ä‡∏£ üíé', 5000)" style="background:rgba(255,255,255,0.05); padding:10px; border-radius:15px; text-align:center;">üíé<br><small>‡∏ø5k</small></div>
        <div onclick="processGift('‡∏°‡∏±‡∏á‡∏Å‡∏£‡∏ó‡∏≠‡∏á üêâ', 50000)" style="background:rgba(255,255,255,0.05); padding:10px; border-radius:15px; text-align:center;">üêâ<br><small>‡∏ø50k</small></div>
    </div>
</div>

<div id="rechargeMenu" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; background: #1a1a1a; border: 2px solid var(--gold); border-radius: 25px; padding: 20px; z-index: 10005;">
    <h3 style="color:var(--gold); text-align:center;">üíé ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç Puffly</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <div onclick="addMoney(100)" style="background:#252525; padding:15px; border-radius:15px; text-align:center;">100 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç<br><small>‡∏ø35</small></div>
        <div onclick="addMoney(1000)" style="background:#252525; padding:15px; border-radius:15px; text-align:center;">1,000 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç<br><small>‡∏ø299</small></div>
    </div>
    <button onclick="document.getElementById('rechargeMenu').style.display='none'" style="width:100%; margin-top:15px; background:none; color:#777;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</div>

<div class="nav">
    <button onclick="changePage('page-feed', this)" class="active"><i class="fa-solid fa-house"></i><span>‡∏™‡∏≥‡∏£‡∏ß‡∏à</span></button>
    <button onclick="changePage('page-chat', this)"><i class="fa-solid fa-comment-dots"></i><span>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span></button>
    <div class="upload-btn" onclick="checkAuthAndAction('upload')"><i class="fa-solid fa-plus"></i></div>
    <button onclick="checkAuthAndAction('live')"><i class="fa-solid fa-tower-broadcast"></i><span>‡πÑ‡∏•‡∏ü‡πå</span></button>
    <button onclick="changePage('page-profile', this)"><i class="fa-solid fa-user-ninja"></i><span>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span></button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
    // --- 1. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase ---
    const firebaseConfig = {
      apiKey: "AIzaSyACTSU6LYObSv5gEAfKJt4Yr4LaCCAkQvw",
      authDomain: "goldorax-game.firebaseapp.com",
      databaseURL: "https://goldorax-game-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "goldorax-game",
      storageBucket: "goldorax-game.firebasestorage.app",
      messagingSenderId: "601999451419",
      appId: "1:601999451419:web:f0782a8437b493eb8f5fbe",
      measurementId: "G-09PW99QK06"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let userData = { balance: 0, earnings: 0, followers: 0 };
    let playerDocId = "";
    let isBlocked = false;

    // --- 2. ‡∏£‡∏∞‡∏ö‡∏ö Auth & Database (‡∏ï‡∏≤‡∏° Security Rules ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) ---
    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginBtn').style.display = 'none';
            playerDocId = user.email === 'admin@gmail.com' ? 'admin@gmail.com' : user.email.split('@')[0];

            db.collection("hoo_hey_how_players").doc(playerDocId).onSnapshot(doc => {
                if (doc.exists) {
                    userData = doc.data();
                    updateWalletUI();
                } else {
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà (balance ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 0 ‡∏ï‡∏≤‡∏° Rules)
                    db.collection("hoo_hey_how_players").doc(playerDocId).set({
                        uid: user.uid, name: user.displayName, balance: 0, earnings: 0, followers: 0, role: 'user'
                    });
                }
            });
        }
    });

    // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ 100%) ---
    function updateWalletUI() {
        document.getElementById('userBalanceDisplay').innerText = (userData.balance || 0).toLocaleString();
        document.getElementById('walletBalance').innerText = (userData.earnings || 0).toLocaleString();
        document.getElementById('followerCountDisplay').innerText = `‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°: ${userData.followers || 0} ‡∏Ñ‡∏ô`;
        
        const withdrawBtn = document.getElementById('withdrawBtn');
        if (userData.followers >= 1000) {
            withdrawBtn.style.background = "var(--puffly-green)";
            withdrawBtn.style.color = "#000";
            withdrawBtn.style.cursor = "pointer";
            withdrawBtn.innerText = "‡∏ñ‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏™‡∏° (‡∏´‡∏±‡∏Å 5%)";
        }
    }

    async function processGift(name, price) {
        if (!auth.currentUser) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô");
        if (userData.balance < price) return alert("‡∏¢‡∏≠‡∏î‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠!");

        if (confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á ${name} ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ø${price}?`)) {
            await db.collection("hoo_hey_how_players").doc(playerDocId).update({
                balance: firebase.firestore.FieldValue.increment(-price),
                earnings: firebase.firestore.FieldValue.increment(price * 0.7)
            });
            const alertBox = document.getElementById('giftAlert');
            document.getElementById('giftAlertText').innerText = `‡∏™‡πà‡∏á ${name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`;
            alertBox.style.display = 'block';
            setTimeout(() => { alertBox.style.display = 'none'; }, 3000);
            toggleGiftMenu(false);
        }
    }

    function checkAuthAndAction(action) {
        if (!auth.currentUser) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö");
        if (userData.followers < 1000) return alert("üîí ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° 1,000 ‡∏Ñ‡∏ô");
        alert("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö " + action);
    }

    // --- ‡∏£‡∏∞‡∏ö‡∏ö Feed & Chat (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå index.html ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ---
    function initFeed() {
        const container = document.getElementById('feedContainer');
        const data = [
            { user: '@Creator_Asura', desc: "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Asura's Ransom! ‚òÅÔ∏èüéÆ", liked: false },
            { user: '@Puffly_Official', desc: "New Generation Creator #Puffly", liked: true }
        ];
        container.innerHTML = "";
        data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.innerHTML = `<video src="https://www.w3schools.com/html/mov_bbb.mp4" loop muted playsinline></video>
                <div class="feed-sidebar">
                    <div onclick="goToProfile('${item.user}')" style="cursor:pointer;"><div style="width:45px;height:45px;border-radius:50%;border:2px solid #fff;overflow:hidden;"><img src="https://via.placeholder.com/45" style="width:100%;"></div></div>
                    <div class="action-item"><div class="btn-circle ${item.liked?'liked':''}" onclick="this.classList.toggle('liked')"><i class="fa-solid fa-cloud"></i></div><span class="action-label">1.2k</span></div>
                    <div class="action-item" onclick="toggleGiftMenu(true)"><div class="btn-circle" style="color:var(--gold);"><i class="fa-solid fa-gift"></i></div><span class="action-label">‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</span></div>
                </div>
                <div style="position:absolute; left:15px; bottom:115px;"><h3>${item.user}</h3><p>${item.desc}</p></div>`;
            const vid = card.querySelector('video');
            card.onclick = () => vid.paused ? vid.play() : vid.pause();
            container.appendChild(card);
        });
    }

    function changePage(pageId, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
    }

    function sendPrivateMsg() {
        if (isBlocked) return;
        const input = document.getElementById('chatInput');
        if(!input.value.trim()) return;
        const msg = document.createElement('div');
        msg.style = "align-self:flex-end; background:var(--puffly-grad); padding:10px 15px; border-radius:15px; color:#000; margin-bottom:10px; max-width:80%;";
        msg.innerText = input.value;
        document.getElementById('chatBox').appendChild(msg);
        input.value = '';
        document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
    }

    async function loginWithGoogle() {
        await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
    }

    function toggleBlock() { isBlocked = !isBlocked; document.getElementById('chatStatusText').innerText = isBlocked ? "‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß" : "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Arixo"; }
    function toggleGiftMenu(s) { document.getElementById('giftMenu').style.display = s ? 'block' : 'none'; }
    function toggleExtraMenu() { const m = document.getElementById('extraMenu'); m.style.display = (m.style.display==='grid')?'none':'grid'; }

    window.onload = () => { initFeed(); updateWalletUI(); };
</script>
</body>
</html>
